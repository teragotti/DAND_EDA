TITLE by Georg GOTTFRIED
========================================================

```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
# Load all of the packages that you end up using in your analysis in this code
# chunk.

# Notice that the parameter "echo" was set to FALSE for this code chunk. This
# prevents the code from displaying in the knitted HTML output. You should set
# echo=FALSE for all code chunks in your file, unless it makes sense for your
# report to show the code that generated a particular plot.

# The other parameters for "message" and "warning" should also be set to FALSE
# for other code chunks once you have verified that each plot comes out as you
# want it to. This will clean up the flow of your report.
library(dplyr)
library(tidyr)
library(ggplot2)
library(gridExtra)
library(GGally)
library(memisc)
```

```{r echo=FALSE, Load_the_Data}
setwd("~/udacity/DAND/exploratory_data_analysis/eda-course-materials/DAND_EDA/")
wine <- read.csv("wineQualityWhites.csv")
```
# A short introdcution into the dataset
Citation Request:
  This dataset is public available for research. The details are described in [Cortez et al., 2009]. 
  Please include this citation if you plan to use this database:

  P. Cortez, A. Cerdeira, F. Almeida, T. Matos and J. Reis. 
  Modeling wine preferences by data mining from physicochemical properties.
  In Decision Support Systems, Elsevier, 47(4):547-553. ISSN: 0167-9236.

  Available at: [@Elsevier] http://dx.doi.org/10.1016/j.dss.2009.05.016
                [Pre-press (pdf)] http://www3.dsi.uminho.pt/pcortez/winequality09.pdf
                [bib] http://www3.dsi.uminho.pt/pcortez/dss09.bib
                

This data set contains 4,898 white wines with 11 variables on quantifying the chemical properties of each wine. At least 3 wine experts rated the quality of each wine, providing a rating between 0 (very bad) and 10 (very excellent).
The data set has been provided by Udacity for the Nandodegree Project in exploratory data analysis (EDA).
A detailed description of the dataset is available [here](https://s3.amazonaws.com/udacity-hosted-downloads/ud651/wineQualityInfo.txt)

Our guiding question is: 
**Which chemical properties influence the quality of white wines?**

# Univariate Plots Section

prove that X column is a unique identifier
```{r echo=FALSE, Univariate_Plots}
str(wine)

summary(wine$X)
summary(unique(wine$X)) 
```

exclude the unique id X
```{r echo=FALSE, Univariate_Plots}
wine <- wine %>% dplyr::selectselect(X)
```

analyse the dependent variable
```{r echo=FALSE, Univariate_Plots}
summary(wine$quality)
```

quality ranges from 3 to 9 having a normal distribution
We use a bar chart instead of histogram because of the categorial variable on the x-axis.
```{r echo=FALSE, Univariate_Plots}
ggplot(data = wine,
       aes(x = quality)
       ) +
  geom_bar() +
  scale_x_continuous(
    limits = c(2,10),
    breaks = c(seq(3,9,1))
    )
```

convert quality integer to an ordered factor for better analysis
Conceptually, factors are variables in R which take on a limited number of different values
```{r echo=FALSE, Univariate_Plots}
wine$quality.ord <- ordered(wine$quality)
wine$quality.bucket <- 
  ordered(cut(wine$quality, breaks = c(0, 4, 7, 10)),
          labels = (c("bad","average","outstanding"))
          )
str(wine)
summary(wine$quality.bucket)

ggpairs(wine)
```

there is a bimodal distribution in residual sugar. This can be explained by the fact that there are dry and sweet white wines available. They taste very different and target different audiences. We will have to consider this in further analasys.
```{r echo=FALSE, Univariate_Plots}
ggplot(data = wine,
       aes(x = residual.sugar)
       ) +
  geom_histogram(aes(fill = quality.bucket),
                 color = 'black',
                 binwidth = 0.1
                 ) +
  scale_x_log10(breaks = c(seq(1,5,1), 10, 20, 40, 80))
summary(wine$residual.sugar)
```


I decided to introduce a new variable to split the dataset dry wines and sweet wines
```{r echo=FALSE, Univariate_Plots}
wine$residual.sugar.bucket <- 
  factor(cut(wine$residual.sugar, breaks = c(0, 3.5, 100)),
         labels = c("dry", "sweet")
  )
str(wine)

theme_set(theme_minimal(10))
?theme_set
ggpairs(filter(wine,residual.sugar.bucket == "sweet"))
ggpairs(filter(wine,residual.sugar.bucket == "dry"),
        upper = list(continuous = wrap(ggally_cor,
                                       size = 3, 
                                       color = "black")
                     )
        )

ggpairs(wine,
        upper = list(continuous = 
                       wrap(ggally_cor,
                            size = 2, 
                            color = "black")
                     )
)
names(wine)
```

the density of sweet wine is higher than the density of dry wine
```{r echo=FALSE, Univariate_Plots}
ggplot(wine,
       aes(x = density)
       ) +
  geom_histogram() +
  facet_wrap(~ wine$residual.sugar.bucket, ncol=1) +
  scale_x_continuous(limits = 
                       c(quantile(wine$density, .01),
                         quantile(wine$density, .99)
                         )
  )
```

alcohol of dry wiNE is higher than that of sweet wine
```{r echo=FALSE, Univariate_Plots}
ggplot(wine,
       aes(x = alcohol)
       ) +
  geom_histogram(binwidth = .1) +
  facet_wrap(~ wine$residual.sugar.bucket, ncol=1)
```

we get a better distribution of chlorides on a log10 scale
```{r echo=FALSE, Univariate_Plots}
ggplot(wine,
       aes(x = chlorides)
       ) +
  geom_histogram(bins = 50) +
  facet_wrap(~ wine$residual.sugar.bucket, ncol=1) +
  scale_x_log10()

wine$chlorides.log <- log10(wine$chlorides)

str(wine)
```


# Univariate Analysis

### What is the structure of your dataset?
The dependent variable is the quality with integer rates from 3 to 9 in the 
given dataset. The limited number of grades make this a candidate for an 
ordered factor.
The chemical variables are all continuous numbers which contain often outliers

### What is/are the main feature(s) of interest in your dataset?
The main features of interest are
+ to differ between sweet and dry wines
+ to get rid of the outliers
+ to focus on the dependent variable quality


### What other features in the dataset do you think will help support your \
investigation into your feature(s) of interest?

+ to handle the skewed distributions if necessary
+ possibly transform the quality in another way 

### Did you create any new variables from existing variables in the dataset?
+ I added a quality.bucket with just three categories (bad, avarge, outstanding) 
to analyse further if there is something that makes a wine really bad or realy 
good apart from average.
+ I added a factor residual.sugar.bucket to accomodate for sweet and dry wines

### Of the features you investigated, were there any unusual distributions? \
Did you perform any operations on the data to tidy, adjust, or change the form \
of the data? If so, why did you do this?

I omited the X column, because it's just a unique identifier of the observation
which is not relevant for the further data analysis
I used the log10 algorithm on residual.sugar to detect the bimodal distribution. While nearly all of the sugar gets ferment for dry wines the residual sugar for sweet wines vary quite a lot.


# Bivariate Plots Section

```{r echo=FALSE, Bivariate_Plots}
ggpairs(wine,
        upper = list(continuous = 
                       wrap(ggally_cor,
                            size = 2, 
                            color = "black")
                     )
)

```

chlorides seem to be negative corelated to quality
```{r echo=FALSE, Bivariate_Plots}
ggplot(data = wine,
       aes(x = chlorides, y = quality.bucket)
       ) +
  geom_point(alpha = 1/5,
             position = position_jitter()
             ) +
  facet_wrap (~ residual.sugar.bucket)
```

There seems to be a certain band of total.sulfur.dioxide required (50 to 220) to get an outstanding quality grade
```{r echo=FALSE, Bivariate_Plots}
wine$bound.sulfur.dioxide <- 
  wine$total.sulfur.dioxide - wine$free.sulfur.dioxide

ggplot(data = wine,
       aes(x = quality.bucket, y = total.sulfur.dioxide)
       ) +
  geom_point(alpha = 1/5,
             position = position_jitter()
             ) +
  facet_wrap (~ residual.sugar.bucket) +
  scale_y_continuous(breaks = c(seq(0,400,50)),
                     minor_breaks = c(seq(70,220,10))
                     )

```

even stronger seems to be the relationship to bound.sulfur.dioxide.
```{r echo=FALSE, Bivariate_Plots}
ggplot(data = wine,
       aes(x = quality.bucket, y = bound.sulfur.dioxide)
       ) +
  geom_boxplot() +
  facet_wrap (~ residual.sugar.bucket) +
  scale_y_continuous(breaks = c(seq(0,400,50)),
                     minor_breaks = c(seq(70,220,10))
                     )

```

# Bivariate Analysis

### Talk about some of the relationships you observed in this part of the \
investigation. How did the feature(s) of interest vary with other features in \
the dataset?

There seems to be a certain band of total.sulfur.dioxide required (50 to 220) to get an outstanding quality grade.
sweet wines allow a slightly higher band

### Did you observe any interesting relationships between the other features \
(not the main feature(s) of interest)?

density, residual sugar and alcohol seem to have an interrelationship. This is also confirmed in the data documentation:
'the density of water is close to that of water depending on the percent alcohol and sugar content'

There is a strong positive relationship between 
+ density and residual sugar
+ a negative relationship between density and alcohol
+ and a negative relationship between residual sugar and alcohol

So we could drop density from further analysis

In addition there is also a positive relationship between free.sulfur.dioxide and total.sulfur.dioxide


### What was the strongest relationship you found?
strong positive relationship between density and residual sugar

# Multivariate Plots Section
ignore density from further analysis
```{r echo=FALSE, Multivariate_Plots}
str(wine)

ggplot(data = wine,
       aes(x = free.sulfur.dioxide,
           y = bound.sulfur.dioxide,
           color = quality.ord)
       ) +
  geom_point()

dry.wine <- wine %>% 
  filter(residual.sugar.bucket == 'dry')

sweet.wine <- wine %>% 
  filter(residual.sugar.bucket == 'sweet')

ggpairs(dry.wine,
        upper = list(continuous = 
                       wrap(ggally_cor,
                            size = 3, 
                            color = "black")
                     )
)

names(dry.wine)

ggplot(data = dry.wine,
       aes(x = chlorides.log, 
           y = citric.acid,
           color = quality.ord)
       ) +
  geom_point(alpha = 1/1) +
  scale_colour_brewer(type = 'div') + 
  guides(colour = 
           guide_legend(override.aes = list(alpha = 1))
         )

ggplot(data = dry.wine,
       aes(x = residual.sugar, 
           y = alcohol,
           color = quality.ord)
       ) +
  geom_point(position = position_jitter(),
             shape = 19
             ) +
  scale_colour_brewer(type = 'div',
                      palette = 'RdYlBu'
                      ) + 
  guides(colour = 
           guide_legend(override.aes = list(alpha = 1))
         ) +
  facet_wrap(~ quality.bucket, ncol=1)

ggplot(data = sweet.wine,
       aes(x = residual.sugar, 
           y = alcohol,
           color = quality.bucket)
       ) +
  geom_point(position = position_jitter(),
             shape = 19
             ) +
  scale_colour_brewer(type = 'div',
                      palette = 'RdYlBu'
                      ) +
  scale_x_continuous(limits = c(0,25))

ggplot(data = wine,
       aes(x = pH, 
           y = citric.acid,
           color = quality.bucket)
       ) +
  geom_point(position = position_jitter(),
             shape = 19
             ) +
  scale_colour_brewer(type = 'div',
                      palette = 'RdYlBu'
                      ) +
  scale_y_continuous(
    limit = c(0, 1)
    ) +
  facet_wrap(~ residual.sugar.bucket, ncol = 1)


?scale_colour_brewer
#BrBG, PiYG, PRGn, PuOr, RdBu, RdGy, RdYlBu, RdYlGn, Spectral
#Accent, Dark2, Paired, Pastel1, Pastel2, Set1, Set2, Set3
```


# Multivariate Analysis

### Talk about some of the relationships you observed in this part of the \
investigation. Were there features that strengthened each other in terms of \
looking at your feature(s) of interest?

### Were there any interesting or surprising interactions between features?


### OPTIONAL: Did you create any models with your dataset? Discuss the \
strengths and limitations of your model.

I decided to go for a logistic regression model.
Well the idea is either to have an outstanding wine or at least avoid a bad taste. That's a binominal dependent variable which would fit the logistic regression model
```

https://www.analyticsvidhya.com/blog/2015/11/beginners-guide-on-logistic-regression-in-r/
```{r echo=FALSE, Multivariate_Plots}
wine$taste.top <- 
  factor(cut(wine$quality, breaks = c(0, 7, 10)),
          labels = (c('N','Y'))
          )

wine$taste.bad <- 
  factor(cut(wine$quality, breaks = c(0, 4, 10)),
          labels = (c('Y','N'))
          )

dplyr::select(wine, quality.ord, taste.top, taste.bad)
table(wine$taste.bad, wine$taste.top)

str(wine)
dry.wine <- filter(wine, residual.sugar.bucket == 'dry')
sweet.wine <- filter(wine, residual.sugar.bucket == 'sweet')
table(dry.wine$taste.bad, dry.wine$taste.top)
table(sweet.wine$taste.bad, sweet.wine$taste.top)


#model top wine
names(wine)

m1 <- glm (I(taste.top) ~ I(alcohol),
              data = dry.wine, 
              family = binomial
              )
m2 <- update(m1, ~ . + free.sulfur.dioxide)
m3 <- update(m2, ~ . + I(log10(residual.sugar)))
m4 <- update(m3, ~ . + citric.acid)
m5 <- update(m4, ~ . + pH)
m6 <- update(m5, ~ . + chlorides.log)
mtable(m1, m2, m3, m4, m5, m6)

#test bad wine
m1 <- glm (I(taste.bad) ~ I(alcohol),
              data = sweet.wine, 
              family = binomial
              )
m2 <- update(m1, ~ . + free.sulfur.dioxide)
m3 <- update(m2, ~ . + I(log10(residual.sugar)))
m4 <- update(m3, ~ . + citric.acid)
m5 <- update(m4, ~ . + pH)
m6 <- update(m5, ~ . + chlorides.log)
mtable(m1, m2, m3, m4, m5, m6)
```

------

# Final Plots and Summary

> **Tip**: You've done a lot of exploration and have built up an understanding
of the structure of and relationships between the variables in your dataset.
Here, you will select three plots from all of your previous exploration to
present here as a summary of some of your most interesting findings. Make sure
that you have refined your selected plots for good titling, axis labels (with
units), and good aesthetic choices (e.g. color, transparency). After each plot,
make sure you justify why you chose each plot by describing what it shows.

### Plot One
```{r echo=FALSE, Plot_One}
#there is a bimodal distribution in residual sugar. This can be explained by the fact that there are dry and sweet white wines available. They taste very different and target different audiences. We will have to consider this in further analasys.
p1 <- ggplot(data = wine,
       aes(x = residual.sugar)
       ) +
  geom_histogram(aes(fill = quality.bucket),
                 color = 'black',
                 binwidth = 0.1
                 ) +
  scale_x_log10(breaks = c(seq(1,5,1), 10, 20, 40, 80))

p1 +
  ggtitle("residual sugar") +
  xlab("residual sugar") +
  ylab("nr of tastings")
```

### Description One


### Plot Two

```{r echo=FALSE, Plot_Two}
ggplot(data = wine,
      aes(x = alcohol, 
          y = pH,
          color = quality.ord)
      ) +
  geom_point() +
  scale_colour_brewer(type = 'div',
                      palette = 'RdYlBu'
                      ) +
facet_wrap(~ residual.sugar.bucket, ncol = 1)


ggplot(data = filter(wine, quality.bucket != 'average'),
      aes(x = free.sulfur.dioxide, 
          y = chlorides.log,
          color = quality.bucket
          )
      ) +
  geom_point() + #aes(size = residual.sugar)) +
  scale_colour_brewer(type = 'qual'
#                      palette = 'RdBu'
                      ) +
  facet_wrap(~ residual.sugar.bucket, ncol = 1) +
  scale_x_log10()


ggplot(data = wine,
      aes(x = alcohol, 
          y = residual.sugar,
          color = quality.ord)
      ) +
  geom_point() +
  scale_colour_brewer(type = 'div',
                      palette = 'RdYlBu'
                      ) +
  scale_y_continuous(limit= c(0,quantile(wine$residual.sugar, .95))) +
  facet_wrap(~ residual.sugar.bucket, ncol = 1)
```

### Description Two


### Plot Three
```{r echo=FALSE, Plot_Three}

```

### Description Three

------

# Reflection

> **Tip**: Here's the final step! Reflect on the exploration you performed and
the insights you found. What were some of the struggles that you went through?
What went well? What was surprising? Make sure you include an insight into
future work that could be done with the dataset.

> **Tip**: Don't forget to remove this, and the other **Tip** sections before
saving your final work and knitting the final report!